USE WAREHOUSE BASIC;
USE DATABASE FIRSTDB;
CREATE OR REPLACE TABLE AR_SALES_FINAL_DATA
    (
        ORDER_ID VARCHAR(35),
        ORDER_DATE DATE,
        SHIP_DATE DATE,
        SHIP_MODE CHAR(35),
        CUSTOMER_NAME CHAR(35),
        SEGMENT CHAR(15),
        STATE CHAR(45),
        COUNTRY CHAR(35),
        MARKET CHAR(35),
        REGION CHAR(35),
        PRODUCT_ID VARCHAR(40),
        CATEGORY CHAR(35),
        SUB_CATEGORY CHAR(35),
        PRODUCT_NAME CHAR(200),
        SALES INT,
        QUANTITY VARCHAR(8),
        DISCOUNT FLOAT(4),
        PROFIT INT,
        SHIPPING_COST FLOAT(5),
        ORDER_PRIORITY CHAR(10),
        YEAR_OF INT
    );
    
SELECT * FROM AR_SALES_FINAL_DATA;

DESCRIBE TABLE AR_SALES_FINAL_DATA;

------1.SET PRIMARY KEY---------

----NOTE:NO PRIMARY IS ALREADY PRESENT IN THE TABLE----

ALTER TABLE AR_SALES_FINAL_DATA
ADD PRIMARY KEY(ORDER_ID);


DESCRIBE TABLE AR_SALES_FINAL_DATA;

------2.DATATYPE OF ORDER_DATE AND SHIP_DATE--------
    
SELECT column_name, data_type FROM information_schema.columns
WHERE table_schema='PUBLIC' AND table_name='AR_SALES_FINAL_DATA' AND column_name in ('ORDER_DATE','SHIP_DATE');  

------IT SHOULD BE IN DATE  DATATYPE ONLY----------

------3. EXTRACT THE LAST NUMBER AFTER THE - AND CREATE OTHER COLUMN AND UPDATE IT---------

SELECT * FROM AR_SALES_FINAL_DATA;

SELECT *,SUBSTRING(ORDER_ID,9)AS ORDER_EXTRACT FROM AR_SALES_FINAL_DATA;

-------4.FLAG WHEN DISCOUNT>0 AS YES AND DISCOUNT<=0 AS NO;--------


SELECT *,
   CASE WHEN DISCOUNT >0 THEN 'YES'
   ELSE 'NO'
   END AS DSICOUNT_FLAG
FROM AR_SALES_FINAL_DATA;


------5.DATE DIFFERENCE BETWEEN ORDER_DATE AND SHIP_DATE-------

SELECT *,
  DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) AS PROCESS_DAYS
FROM AR_SALES_FINAL_DATA;


------6. FLAG THE PROCESS DAY AS BY RATING ACCORDING TO THE NUMBER OF DAYS.--------

SELECT *,
  DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) AS PROCESS_DAYS,
  CASE 
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 3 THEN 5
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) > 3 and DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 6 THEN 4
    WHEN DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) > 6 and DATEDIFF('DAYS',ORDER_DATE,SHIP_DATE) <= 10 THEN 3
    ELSE 2
  END as RATING
FROM AR_SALES_FINAL_DATA;

SELECT * FROM AR_SALES_FINAL_DATA;




